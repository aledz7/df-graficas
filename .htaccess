RewriteEngine On

# Preservar o header Authorization para o Laravel
RewriteCond %{HTTP:Authorization} .
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

# Redirecionar requisições da API para o backend Laravel (backend/public/index.php)
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^(.*)$ backend/public/index.php [L]

# Redirecionar storage do backend
RewriteCond %{REQUEST_URI} ^/storage/
RewriteRule ^storage/(.*)$ backend/storage/app/public/$1 [L]

# Para arquivos e diretórios que existem, servir diretamente
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Para todas as outras requisições (SPA frontend), servir dist/index.html
RewriteRule ^(.*)$ dist/index.html [L]